<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://bootswatch.com/5/zephyr/bootstrap.min.css"
    />
    <meta name="csrf-token" content="<%= csrfToken %>" />
    <meta name="election-id" content="<%= election.id %>" />
    <script>
      // Need to work on this
      let token = document
        .querySelector('meta[name="csrf-token"]')
        .getAttribute("content");
      let electionId = document
        .querySelector('meta[name="election-id"]')
        .getAttribute("content");

      function deleteQuestion(id) {
        fetch(`/elections/${electionId}/questions/${id}`, {
          method: "DELETE",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            _csrf: token,
          }),
        })
          .then((res) => {
            console.log(res);
            if (res.ok) window.location.reload();
          })
          .catch((err) => {
            console.log(err);
          });
      }
    </script>
    <title><%= title %></title>
  </head>
  <body>
    <%- include('../partials/header'); %>
    <div class="container mt-5">
      <div class="row">
        <div class="col-md-6 offset-md-3">
          <%- include('../partials/nav'); %>
          <h1 class=""><%= title %></h1>
          <section class="mt-5">
            <div class="d-flex justify-content-between align-items-center">
              <h2>Questions</h2>
              <a
                href="/elections/<%= election.id %>/questions/new"
                class="btn btn-outline-primary"
                >Add Question</a
              >
            </div>
            <hr />
            <p>You have <%= questions.length %> questions</p>

            <ul class="list-group">
              <% for (let question of questions) { %>
              <li class="list-group-item d-flex justify-content-between">
                <a
                  href="/elections/<%=election.id %>/questions/<%= question.id %>"
                  id="question-<%= question.id %>"
                  ><%= question.title %></a
                >
                <span>
                  <a
                    href="<%=election.id %>/questions/<%= question.id %>/edit"
                    class="btn btn-sm btn-outline-info"
                    >Edit</a
                  >
                  <a
                    href="#"
                    class="btn btn-sm btn-outline-danger"
                    onclick="deleteQuestion(<%= question.id %>)"
                    >Delete</a
                  >
                </span>
              </li>
              <% } %>
            </ul>
          </section>
          <section class="mt-5">
            <div class="d-flex justify-content-between align-items-center">
              <h2>Voters</h2>
              <a
                href="/elections/<%= election.id %>/questions/new"
                class="btn btn-outline-primary"
                >Add Voter</a
              >
            </div>
            <hr />
          </section>
        </div>
      </div>
    </div>
  </body>
</html>
